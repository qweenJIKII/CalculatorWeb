<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#171a2b"/>
  <title>製品詳細 | 簡易電卓</title>
  <link rel="manifest" href="./manifest.webmanifest"/>
  <style>
    :root { --bg:#0f1222; --panel:#171a2b; --panel-2:#1f2340; --text:#e9ecf1; --muted:#a8b0c2; --accent:#6ea8ff; }
    html,body{height:100%}
    body{ margin:0; background: radial-gradient(1200px 600px at 10% 0%, #13173a 0%, var(--bg) 50%, #0b0e1a 100%); color:var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; display:flex; align-items:flex-start; justify-content:center; min-height:100dvh; padding:16px env(safe-area-inset-right) calc(16px + env(safe-area-inset-bottom)) env(safe-area-inset-left); overflow:auto; }
    .app{ width:min(820px,96vw); background:linear-gradient(180deg,var(--panel) 0%, var(--panel-2) 100%); border:1px solid rgba(255,255,255,.06); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); overflow:hidden; }
    .header{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.06); }
    .tabs{ display:flex; gap:10px; padding: 8px 14px; border-bottom:1px solid rgba(255,255,255,.06); background: rgba(255,255,255,0.02); overflow-x:auto; overflow-y:hidden; -webkit-overflow-scrolling:touch; }
    .tab{ color: var(--muted); text-decoration: none; padding:6px 10px; border:1px solid rgba(255,255,255,.08); border-radius:8px; background: rgba(255,255,255,.02); font-size:13px; flex:0 0 auto; white-space:nowrap; }
    .tab.active{ color:var(--text); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.05); }
    .content{ padding:16px 14px 22px; display:grid; gap:14px; }
    .card{ border:1px solid rgba(255,255,255,.08); border-radius:12px; background: rgba(255,255,255,.03); padding:14px; }
    .title2{ font-weight:700; margin-bottom:8px; }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .btn{ padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); color:var(--text); font-weight:700; cursor:pointer; }
    .muted{ color:var(--muted); font-size:12px; }
    table{ width:100%; border-collapse:collapse; }
    th, td{ text-align:left; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,.08); }
  </style>
</head>
<body>
  <main class="app" aria-label="製品詳細">
    <div class="header">
      <div class="title">簡易電卓 - 製品詳細</div>
      <div class="muted">コードで検索</div>
    </div>
    <nav class="tabs" aria-label="ナビゲーション">
      <a class="tab" href="./">電卓</a>
      <a class="tab" href="./help.html">説明</a>
      <a class="tab" href="./memo.html">メモ</a>
      <a class="tab" href="./camera.html">カメラ</a>
      <a class="tab" href="./qr.html">QR</a>
      <a class="tab" href="./timer.html">タイマー</a>
      <a class="tab" href="./convert.html">換算</a>
      <a class="tab" href="./password.html">PW</a>
      <a class="tab" href="./voice.html">音声</a>
      <a class="tab" href="./music.html">音楽</a>
      <a class="tab active" href="./product.html">製品</a>
      <a class="tab" href="./calendar.html">カレンダー</a>
    </nav>

    <section class="content">
      <div class="card">
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <div id="name" class="title2">製品名</div>
            <div class="muted">コード: <span id="code">-</span> / ブランド: <span id="brand">-</span> / カテゴリ: <span id="category">-</span></div>
          </div>
          <div class="row">
            <button id="shareBtn" class="btn">共有</button>
          </div>
        </div>
        <p id="desc" style="margin:10px 0 0;">説明</p>
      </div>
      <div id="specCard" class="card" style="display:none;">
        <div class="title2">仕様</div>
        <table id="specs"></table>
      </div>
      <div class="muted">製品データは `data/products.json` に格納されています。コードが一致する製品が見つからない場合は基本情報のみ表示します。</div>
    </section>
  </main>

  <script>
    (function(){
      const $ = (s)=> document.querySelector(s);
      const params = new URLSearchParams(location.search);
      const codeParam = (params.get('code')||'').trim();
      const code = codeParam.replace(/\s+/g,'');
      const isLikelyCode = /^\d{8}$|^\d{12}$|^\d{13}$/.test(code);
      const state = { product:null };

      function render(){
        const p = state.product || { code: code || '-', name:'不明な製品', brand:'-', category:'-', description:'一致する製品が見つかりませんでした。', specs:{} };
        $('#name').textContent = p.name || '製品';
        $('#code').textContent = p.code || code || '-';
        $('#brand').textContent = p.brand || '-';
        $('#category').textContent = p.category || '-';
        $('#desc').textContent = p.description || '';
        const specs = p.specs || {};
        const specTable = $('#specs');
        specTable.innerHTML = '';
        const keys = Object.keys(specs);
        if (keys.length){
          $('#specCard').style.display = '';
          for (const k of keys){
            const v = Array.isArray(specs[k]) ? specs[k].join(', ') : (typeof specs[k]==='object' ? JSON.stringify(specs[k]) : String(specs[k]));
            const tr = document.createElement('tr');
            tr.innerHTML = `<th style="width:30%">${k}</th><td>${v}</td>`;
            specTable.appendChild(tr);
          }
        } else { $('#specCard').style.display = 'none'; }
      }

      async function load(){
        try{
          if (!isLikelyCode && !code){ render(); return; }
          const res = await fetch('./data/products.json', { cache:'no-store' });
          const json = await res.json();
          const list = json?.products || [];
          state.product = list.find(p=> (p.code||'') === code) || null;
        }catch(_){ state.product = null; }
        render();
      }

      async function share(){
        const p = state.product || { name:'製品', code };
        const url = `${location.origin}${location.pathname}?code=${encodeURIComponent(p.code||code)}`;
        const text = `${p.name} (コード: ${p.code||code})\n${p.description||''}\n${url}`;
        if (navigator.share){ try{ await navigator.share({ title:p.name, text, url }); return; }catch(_){ } }
        try{ await navigator.clipboard?.writeText(text); alert('情報をコピーしました'); }catch(_){ }
      }

      $('#shareBtn').addEventListener('click', share);

      // SW best-effort
      if ('serviceWorker' in navigator){ window.addEventListener('load', ()=>{ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }); }
      load();
    })();
  </script>
</body>
</html>
